# 官方智能合约学习

本节介绍 Uniswap 子图以及如何与之交互。Uniswap 子图随着时间的推移索引来自 Uniswap 合约的数据。它组织了有关交易对、代币、Uniswap 整体等的数据。每当在 Uniswap 上进行交易时，子图都会更新。子图运行在[The Graph](https://thegraph.com/)协议的托管服务上，可以公开查询。

[Subgraph Explorer](https://thegraph.com/explorer/subgraph/uniswap/uniswap-v2) - 用于为开发人员查询数据和端点的沙箱。

[Uniswap V2 Subgraph](https://github.com/Uniswap/uniswap-v2-subgraph) - 已部署子图的源代码。

子图提供 Uniswap 当前状态的快照，并跟踪历史数据。它目前用于为[uniswap.info 供电](https://uniswap.info/)。**它不打算用作构建交易的数据源（应直接引用合约以获得最可靠的实时数据）。**

### 一、实体

实体定义子图的模式，并表示可以查询的数据。每个实体中都有一组字段，用于存储与该实体相关的有用信息。下面是 Uniswap 子图中可用实体的列表，以及可用字段的描述。

要查看所有实体的交互式沙箱，请参阅[Graph Explorer](https://thegraph.com/explorer/subgraph/uniswap/uniswap-v2)。

每个实体都定义了一个值类型，它始终是基本的 AssemblyScript 类型，或者是 The Graph 的自定义 TypeScript 库提供的自定义类型。有关值类型的更多信息，请参见[此处](https://thegraph.com/docs/assemblyscript-api#api-reference)。

##### 1.1 Uniswap Factory

The Uniswap Factory entity is responsible for storing aggregate information across all Uniswap pairs. It can be used to view stats about total liquidity, volume, amount of pairs and more. There is only one UniswapFactory entity in the subgraph.

| Field Name        | Value Type | Description                                                     |
| ----------------- | ---------- | --------------------------------------------------------------- |
| id                | ID         | factory address                                                 |
| pairCount         | Int        | amount of pairs created by the Uniswap factory                  |
| totalVolumeUSD    | BigDecimal | all time USD volume across all pairs (USD is derived)           |
| totalVolumeETH    | BigDecimal | all time volume in ETH across all pairs (ETH is derived)        |
| totalLiquidityUSD | BigDecimal | total liquidity across all pairs stored as a derived USD amount |
| totalLiquidityETH | BigDecimal | total liquidity across all pairs stored as a derived ETH amount |
| txCount           | BigInt     | all time amount of transactions across all pairs                |

##### 1.2 Token

Stores aggregated information for a specific token across all pairs that token is included in.

| Field Name         | Value Type | Description                                                                                                  |
| ------------------ | ---------- | ------------------------------------------------------------------------------------------------------------ |
| id                 | ID         | token address                                                                                                |
| symbol             | String     | token symbol                                                                                                 |
| name               | String     | token name                                                                                                   |
| decimals           | BigInt     | token decimals                                                                                               |
| tradeVolume        | BigDecimal | amount of token traded all time across all pairs                                                             |
| tradeVolumeUSD     | BigDecimal | amount of token in USD traded all time across pairs (only for tokens with liquidity above minimum threshold) |
| untrackedVolumeUSD | BigDecimal | amount of token in USD traded all time across pairs (no minimum liquidity threshold)                         |
| txCount            | BigInt     | amount of transactions all time in pairs including token                                                     |
| totalLiquidity     | BigDecimal | total amount of token provided as liquidity across all pairs                                                 |
| derivedETH         | BigDecimal | ETH per token                                                                                                |

##### 1.3 Pair

Information about a pair. Includes references to each token within the pair, volume information, liquidity information, and more. The pair entity mirrors the pair smart contract, and also contains aggregated information about use.

| Field Name           | Value Type          | Description                                                                                                         |
| -------------------- | ------------------- | ------------------------------------------------------------------------------------------------------------------- |
| id                   | ID                  | pair contract address                                                                                               |
| factory              | UniswapFactory      | reference to Uniswap factory entity                                                                                 |
| token0               | Token               | reference to token0 as stored in pair contract                                                                      |
| token1               | Token               | reference to token1 as stored in pair contract                                                                      |
| reserve0             | BigDecimal          | reserve of token0                                                                                                   |
| reserve1             | BigDecimal          | reserve of token1                                                                                                   |
| totalSupply          | BigDecimal          | total supply of liquidity token distributed to LPs                                                                  |
| reserveETH           | BigDecimal          | total liquidity in pair stored as an amount of ETH                                                                  |
| reserveUSD           | BigDecimal          | total liquidity amount in pair stored as an amount of USD                                                           |
| trackedReserveETH    | BigDecimal          | total liquidity with only tracked amount (see tracked amounts)                                                      |
| token0Price          | BigDecimal          | token0 per token1                                                                                                   |
| token1Price          | BigDecimal          | token1 per token0                                                                                                   |
| volumeToken0         | BigDecimal          | amount of token0 swapped on this pair                                                                               |
| volumeToken1         | BigDecimal          | amount of token1 swapped on this pair                                                                               |
| volumeUSD            | BigDecimal          | total amount swapped all time in this pair stored in USD (only tracked if USD liquidity is above minimum threshold) |
| untrackedVolumeUSD   | BigDecimal          | total amount swapped all time in this pair stored in USD, no minimum liquidity threshold                            |
| txCount              | BigInt              | all time amount of transactions on this pair                                                                        |
| createdAtTimestamp   | BigInt              | timestamp contract was created                                                                                      |
| createdAtBlockNumber | BigInt              | Ethereum block contract was created                                                                                 |
| liquidityPositions   | [LiquidityPosition] | array of liquidity providers, used as a reference to LP entities                                                    |

##### 1.4 User

A user entity is created for any address that provides liquidity to a pool on Uniswap. This entity can be used to track open positions for users. LiquidyPosition entities can be referenced to get specific data about each position.

| Field Name         | Value Type          | Description                                    |
| ------------------ | ------------------- | ---------------------------------------------- |
| id                 | ID                  | user address                                   |
| liquidityPositions | [LiquidityPosition] | array of all liquidity positions user has open |
| usdSwapped         | BigDecimal          | total USD value swapped                        |

##### 1.5 LiquidityPosition

This entity is used to store data about a user's liquidity position. This information, along with information from the pair itself can be used to provide position sizes, token deposits, and more.

| Field Name            | Value Type | Description                                            |
| --------------------- | ---------- | ------------------------------------------------------ |
| id                    | ID         | user address and pair address concatenated with a dash |
| user                  | User       | reference to user                                      |
| pair                  | Pair       | reference to the pair liquidity is being provided on   |
| liquidityTokenBalance | BigDecimal | amount of LP tokens minted for this position           |

##### 1.6 Transaction

Transaction entities are created for each Ethereum transaction that contains an interaction within Uniswap contracts. This subgraph tracks Mint, Burn, and Swap events on the Uniswap core contracts. Each transaction contains 3 arrays, and at least one of these arrays has a length of 1.

| Field Name  | Value Type | Description                                               |
| ----------- | ---------- | --------------------------------------------------------- |
| id          | ID         | Ethereum transaction hash                                 |
| blockNumber | BigInt     | block transaction was mined in                            |
| timestamp   | BigInt     | timestamp for transaction                                 |
| mints       | [Mint]     | array of Mint events within the transaction, 0 or greater |
| burns       | [Burn]     | array of Burn events within transaction, 0 or greater     |
| swaps       | [Swap]     | array of Swap events within transaction, 0 or greater     |

##### 1.7 Mint

Mint entities are created for every emitted Mint event on the Uniswap core contracts. The Mint entity stores key data about the event like token amounts, who sent the transaction, who received the liquidity, and more. This entity can be used to track liquidity provisions on pairs.

| Field Name   | Value Type  | Description                                                 |
| ------------ | ----------- | ----------------------------------------------------------- |
| id           | ID          | Transaction hash plus index in the transaction mint array   |
| transaction  | Transaction | reference to the transaction Mint was included in           |
| timestamp    | BigInt      | timestamp of Mint, used to sort recent liquidity provisions |
| pair         | Pair        | reference to pair                                           |
| to           | Bytes       | recipient of liquidity tokens                               |
| liquidity    | BigDecimal  | amount of liquidity tokens minted                           |
| sender       | Bytes       | address that initiated the liquidity provision              |
| amount0      | BigDecimal  | amount of token0 provided                                   |
| amount1      | BigDecimal  | amount of token1 provided                                   |
| logIndex     | BigInt      | index in the transaction event was emitted                  |
| amountUSD    | BigDecimal  | derived USD value of token0 amount plus token1 amount       |
| feeTo        | Bytes       | address of fee recipient (if fee is on)                     |
| feeLiquidity | BigDecimal  | amount of liquidity sent to fee recipient (if fee is on)    |

##### 1.8 Burn

Burn entities are created for every emitted Burn event on the Uniswap core contracts. The Burn entity stores key data about the event like token amounts, who burned LP tokens, who received tokens, and more. This entity can be used to track liquidity removals on pairs.

| Field Name   | Value Type  | Description                                               |
| ------------ | ----------- | --------------------------------------------------------- |
| id           | ID          | Transaction hash plus index in the transaction burn array |
| transaction  | Transaction | reference to the transaction Burn was included in         |
| timestamp    | BigInt      | timestamp of Burn, used to sort recent liquidity removals |
| pair         | Pair        | reference to pair                                         |
| to           | Bytes       | recipient of tokens                                       |
| liquidity    | BigDecimal  | amount of liquidity tokens burned                         |
| sender       | Bytes       | address that initiated the liquidity removal              |
| amount0      | BigDecimal  | amount of token0 removed                                  |
| amount1      | BigDecimal  | amount of token1 removed                                  |
| logIndex     | BigInt      | index in the transaction event was emitted                |
| amountUSD    | BigDecimal  | derived USD value of token0 amount plus token1 amount     |
| feeTo        | Bytes       | address of fee recipient (if fee is on)                   |
| feeLiquidity | BigDecimal  | amount of tokens sent to fee recipient (if fee is on)     |

##### 1.9 Swap

Swap entities are created for each token swap within a pair. The Swap entity can be used to get things like swap size (in tokens and USD), sender, recipient and more. See the Swap overview page for more information on amounts.

| Field Name  | Value Type  | Description                                           |
| ----------- | ----------- | ----------------------------------------------------- |
| id          | ID          | transaction hash plus index in Transaction swap array |
| transaction | Transaction | reference to transaction swap was included in         |
| timestamp   | BigInt      | timestamp of swap, used for sorted lookups            |
| pair        | Pair        | reference to pair                                     |
| sender      | Bytes       | address that initiated the swap                       |
| amount0In   | BigDecimal  | amount of token0 sold                                 |
| amount1In   | BigDecimal  | amount of token1 sold                                 |
| amount0Out  | BigDecimal  | amount of token0 received                             |
| amount1Out  | BigDecimal  | amount of token1 received                             |
| to          | Bytes       | recipient of output tokens                            |
| logIndex    | BigInt      | event index within transaction                        |
| amountUSD   | BigDecimal  | derived amount of tokens sold in USD                  |

##### 1.10 Bundle

The Bundle is used as a global store of derived ETH price in USD. Because there is no guaranteed common base token across pairs, a global reference of USD price is useful for deriving other USD values. The Bundle entity stores an updated weighted average of ETH<->Stablecoin pair prices. This provides a strong estimate for the USD price of ETH that can be used in other places in the subgraph.

| Field Name | Value Type | Description                                           |
| ---------- | ---------- | ----------------------------------------------------- |
| id         | ID         | constant 1                                            |
| ethPrice   | BigDecimal | derived price of ETH in USD based on stablecoin pairs |

**下面的实体都是historical Entities。**

##### 1.11 UniswapDayData

Tracks data across all pairs aggregated into a daily bucket.

| Field Name        | Value Type      | Description                                                                      |
| ----------------- | --------------- | -------------------------------------------------------------------------------- |
| id                | ID              | unix timestamp for start of day / 86400 giving a unique day index                |
| date              | Int             | unix timestamp for start of day                                                  |
| dailyVolumeETH    | BigDecimal      | total volume across all pairs on this day, stored as a derived amount of ETH     |
| dailyVolumeUSD    | BigDecimal      | total volume across all pairs on this day, stored as a derived amount of USD     |
| totalVolumeETH    | BigDecimal      | all time volume across all pairs in ETH up to and including this day             |
| totalLiquidityETH | BigDecimal      | total liquidity across all pairs in ETH up to and including this day             |
| totalVolumeUSD    | BigDecimal      | all time volume across all pairs in USD up to and including this day             |
| totalLiquidityUSD | BigDecimal      | total liquidity across all pairs in USD up to and including this day             |
| maxStored         | Int             | reference used to store most liquid tokens, used for historical liquidity charts |
| mostLiquidTokens  | [TokenDayData!] | tokens with most liquidity in Uniswap                                            |
| txCount           | BigInt          | number of transactions throughout this day                                       |

##### 1.12 Pair Day Data

Tracks pair data across each day.

| Field Name        | Value Type | Description                                                                                     |
| ----------------- | ---------- | ----------------------------------------------------------------------------------------------- |
| id                | ID         | pair contract address and day id (day start timestamp in unix / 86400) concatenated with a dash |
| date              | Int        | unix timestamp for start of day                                                                 |
| pairAddress       | Bytes      | address for pair contract                                                                       |
| token0            | Token      | reference to token0                                                                             |
| token1            | Token      | reference to token1                                                                             |
| reserve0          | BigDecimal | reserve of token0 (updated during each transaction on pair)                                     |
| reserve1          | BigDecimal | reserve of token1 (updated during each transaction on pair)                                     |
| totalSupply       | BigDecimal | total supply of liquidity token distributed to LPs                                              |
| reserveUSD        | BigDecimal | reserve of token0 plus token1 stored as a derived USD amount                                    |
| dailyVolumeToken0 | BigDecimal | total amount of token0 swapped throughout day                                                   |
| dailyVolumeToken1 | BigDecimal | total amount of token1 swapped throughout day                                                   |
| dailyVolumeUSD    | BigDecimal | total volume within pair throughout day                                                         |
| dailyTxns         | BigInt     | amount of transactions on pair throughout day                                                   |

##### 1.13 TokenDayData

Tracks token data aggregated across all pairs that include token.

| Field Name          | Value Type    | Description                                                                                                                            |
| ------------------- | ------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| id                  | ID            | token address and day id (day start timestamp in unix / 86400) concatenated with a dash                                                |
| date                | Int           | unix timestamp for start of day                                                                                                        |
| token               | Token         | reference to token entity                                                                                                              |
| dailyVolumeToken    | BigDecimal    | amount of token swapped across all pairs throughout day                                                                                |
| dailyVolumeETH      | BigDecimal    | amount of token swapped across all pairs throughout day stored as a derived amount of ETH                                              |
| dailyVolumeUSD      | BigDecimal    | amount of token swapped across all pairs throughout day stored as a derived amount of USD                                              |
| dailyTxns           | BigInt        | amount of transactions with this token across all pairs                                                                                |
| totalLiquidityToken | BigDecimal    | token amount of token deposited across all pairs                                                                                       |
| totalLiquidityETH   | BigDecimal    | token amount of token deposited across all pairs stored as amount of ETH                                                               |
| totalLiquidityUSD   | BigDecimal    | token amount of token deposited across all pairs stored as amount of USD                                                               |
| priceUSD            | BigDecimal    | price of token in derived USD                                                                                                          |
| maxStored           | Int           | amount of token deposited in pair with highest token liquidity - used only as a reference for storing most liquid pairs for this token |
| mostLiquidPairs     | [PairDayData] | pairs with most liquidity for this token                                                                                               |

### 二、Factory

**代码地址**： [`UniswapV2Factory.sol`](https://github.com/Uniswap/uniswap-v2-core/blob/master/contracts/UniswapV2Factory.sol)

**合约地址**： `UniswapV2Factory`部署在`0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f`以太坊主[网上](https://goerli.etherscan.io/address/0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f)，以及[Ropsten](https://ropsten.etherscan.io/address/0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f)、[Rinkeby](https://rinkeby.etherscan.io/address/0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f)、[Görli](https://etherscan.io/address/0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f)和[Kovan](https://kovan.etherscan.io/address/0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f)测试网。它是从提交[8160750 构建](https://github.com/Uniswap/uniswap-v2-core/tree/816075049f811f1b061bca81d5d040b96f4c07eb)的。

##### 2.1  Events

###### PairCreated[​](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory#paircreated "Direct link to heading")

```
event PairCreated(address indexed token0, address indexed token1, address pair, uint);
```

Emitted each time a pair is created via [createPair](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory#createpair).

- `token0` is guaranteed to be strictly less than `token1` by sort order.
- The final `uint` log value will be `1` for the first pair created, `2` for the second, etc. (see [allPairs](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory#allpairs)/[getPair](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory#getpair)).

##### 2.2 Read-Only Functions

###### 2.2.1 getPair[​](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory#getpair "Direct link to heading")

```
function getPair(address tokenA, address tokenB) external view returns (address pair);
```

Returns the address of the pair for `tokenA` and `tokenB`, if it has been created, else `address(0)` (`0x0000000000000000000000000000000000000000`).

- `tokenA` and `tokenB` are interchangeable.
- Pair addresses can also be calculated deterministically via the SDK.

###### 2.2.2 allPairs

```
function allPairs(uint) external view returns (address pair);
```

Returns the address of the `n`th pair (`0`-indexed) created through the factory, or `address(0)` (`0x0000000000000000000000000000000000000000`) if not enough pairs have been created yet.

- Pass `0` for the address of the first pair created, `1` for the second, etc.

###### 2.2.3 allPairsLength

```
function allPairsLength() external view returns (uint);
```

Returns the total number of pairs created through the factory so far.

###### 2.2.4 feeTo

```
function feeTo() external view returns (address);
```

See [Protocol Charge Calculation](https://docs.uniswap.org/protocol/V2/concepts/advanced-topics/fees).

###### 2.2.5 feeToSetter

```
function feeToSetter() external view returns (address);
```

The address allowed to change [feeTo](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory#feeto).

##### 2.3 State-Changing Functions

###### 2.3.1 createPair

```
function createPair(address tokenA, address tokenB) external returns (address pair);
```

Creates a pair for `tokenA` and `tokenB` if one doesn't exist already.

- `tokenA` and `tokenB` are interchangeable.
- Emits [PairCreated](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory#paircreated).

##### 2.4  Interface

```
import '@uniswap/v2-core/contracts/interfaces/IUniswapV2Factory.sol';
```

```
pragma solidity >=0.5.0;

interface IUniswapV2Factory {
  event PairCreated(address indexed token0, address indexed token1, address pair, uint);

  function getPair(address tokenA, address tokenB) external view returns (address pair);
  function allPairs(uint) external view returns (address pair);
  function allPairsLength() external view returns (uint);

  function feeTo() external view returns (address);
  function feeToSetter() external view returns (address);

  function createPair(address tokenA, address tokenB) external returns (address pair);
}
```

### 三、Pair

本文档介绍了uniswap特有的功能。关于ERC-20的功能，请参见[Pair (ERC-20)](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20).。

**代码地址**：[`UniswapV2Pair.sol`](https://github.com/Uniswap/uniswap-v2-core/blob/master/contracts/UniswapV2Pair.sol)

**合约地址**：See [Pair Addresses](https://docs.uniswap.org/protocol/V2/guides/smart-contract-integration/getting-pair-addresses).

##### 3.1 Events

###### 3.1.1 Mint

```
event Mint(address indexed sender, uint amount0, uint amount1);
```

Emitted each time liquidity tokens are created via [mint](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#mint-1).

###### 3.1.2 Burn

```
event Burn(address indexed sender, uint amount0, uint amount1, address indexed to);
```

Emitted each time liquidity tokens are destroyed via [burn](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#burn-1).

###### 3.1.3 Swap

```
event Swap(  address indexed sender,  uint amount0In,  uint amount1In,  uint amount0Out,  uint amount1Out,  address indexed to);
```

Emitted each time a swap occurs via [swap](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#swap-1).

###### 3.1.4 Sync

```
event Sync(uint112 reserve0, uint112 reserve1);
```

Emitted each time reserves are updated via [mint](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#mint-1), [burn](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#burn-1), [swap](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#swap-1), or [sync](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#sync-1).

##### 3.2  Read-Only Functions

###### 3.2.1 MINIMUM_LIQUIDITY

```
function MINIMUM_LIQUIDITY() external pure returns (uint);
```

Returns `1000` for all pairs. See [Minimum Liquidity](https://docs.uniswap.org/protocol/V2/concepts/protocol-overview/smart-contracts#minimum-liquidity).

###### 3.2.2 factory

```
function factory() external view returns (address);
```

Returns the [factory address](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory#address).

###### 3.2.3 token0

```
function token0() external view returns (address);
```

Returns the address of the pair token with the lower sort order.

###### 3.2.4 token1

```
function token1() external view returns (address);
```

Returns the address of the pair token with the higher sort order.

###### 3.2.5 getReserves

```
function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast);
```

Returns the reserves of token0 and token1 used to price trades and distribute liquidity. See [Pricing](https://docs.uniswap.org/protocol/V2/concepts/advanced-topics/pricing). Also returns the `block.timestamp` (mod `2**32`) of the last block during which an interaction occured for the pair.

###### 3.2.6 price0CumulativeLast

```
function price0CumulativeLast() external view returns (uint);
```

See [Oracles](https://docs.uniswap.org/protocol/V2/concepts/core-concepts/oracles).

###### 3.2.7 price1CumulativeLast

```
function price1CumulativeLast() external view returns (uint);
```

See [Oracles](https://docs.uniswap.org/protocol/V2/concepts/core-concepts/oracles).

###### 3.2.8 kLast

```
function kLast() external view returns (uint);
```

Returns the product of the reserves as of the most recent liquidity event. See [Protocol Charge Calculation](https://docs.uniswap.org/protocol/V2/concepts/advanced-topics/fees#protocol-charge-calculation).

##### 3.3 State-Changing Functions

###### 3.3.1 mint

```
function mint(address to) external returns (uint liquidity);
```

Creates pool tokens.

- Emits [Mint](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#mint), [Sync](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#sync), [Transfer](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#transfer).

###### 3.3.2 Burn

```
event Burn(address indexed sender, uint amount0, uint amount1, address indexed to);
```

Emitted each time liquidity tokens are destroyed via [burn](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#burn-1).

###### 3.3.3 Swap

```
event Swap(  address indexed sender,  uint amount0In,  uint amount1In,  uint amount0Out,  uint amount1Out,  address indexed to);
```

Emitted each time a swap occurs via [swap](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#swap-1).

###### 3.3.4 Sync

```
event Sync(uint112 reserve0, uint112 reserve1);
```

Emitted each time reserves are updated via [mint](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#mint-1), [burn](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#burn-1), [swap](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#swap-1), or [sync](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#sync-1).

##### 3.4 Read-Only Functions

###### 3.4.1 MINIMUM_LIQUIDITY

```
function MINIMUM_LIQUIDITY() external pure returns (uint);
```

Returns `1000` for all pairs. See [Minimum Liquidity](https://docs.uniswap.org/protocol/V2/concepts/protocol-overview/smart-contracts#minimum-liquidity).

###### 3.4.2 factory

```
function factory() external view returns (address);
```

Returns the [factory address](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory#address).

###### 3.4.3 token0

```
function token0() external view returns (address);
```

Returns the address of the pair token with the lower sort order.

###### 3.4.4 token1

```
function token1() external view returns (address);
```

Returns the address of the pair token with the higher sort order.

###### 3.4.5 getReserves

```
function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast);
```

Returns the reserves of token0 and token1 used to price trades and distribute liquidity. See [Pricing](https://docs.uniswap.org/protocol/V2/concepts/advanced-topics/pricing). Also returns the `block.timestamp` (mod `2**32`) of the last block during which an interaction occured for the pair.

###### 3.4.6 price0CumulativeLast

```
function price0CumulativeLast() external view returns (uint);
```

See [Oracles](https://docs.uniswap.org/protocol/V2/concepts/core-concepts/oracles).

###### 3.4.7 price1CumulativeLast

```
function price1CumulativeLast() external view returns (uint);
```

See [Oracles](https://docs.uniswap.org/protocol/V2/concepts/core-concepts/oracles).

###### 3.4.8 kLast

```
function kLast() external view returns (uint);
```

Returns the product of the reserves as of the most recent liquidity event. See [Protocol Charge Calculation](https://docs.uniswap.org/protocol/V2/concepts/advanced-topics/fees#protocol-charge-calculation).

##### 3.5 State-Changing Functions

###### 3.5.1 mint

```
function mint(address to) external returns (uint liquidity);
```

Creates pool tokens.

- Emits [Mint](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#mint), [Sync](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#sync), [Transfer](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#transfer).

## 3.5.2 burn

```
function burn(address to) external returns (uint amount0, uint amount1);
```

Destroys pool tokens.

- Emits [Burn](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#burn), [Sync](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#sync), [Transfer](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#transfer).

## 3.5.3 swap

```
function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external;
```

Swaps tokens. For regular swaps, `data.length` must be `0`. Also see [Flash Swaps](https://docs.uniswap.org/protocol/V2/concepts/core-concepts/flash-swaps).

- Emits [Swap](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#swap), [Sync](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#sync).

###### 3.5.4 skim

```
function skim(address to) external;
```

See the [whitepaper](https://docs.uniswap.org/whitepaper.pdf).

###### 3.5.6 sync

```
function sync() external;
```

See the [whitepaper](https://docs.uniswap.org/whitepaper.pdf).

- Emits [Sync](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#sync).

##### 3.6 Interface

```
import '@uniswap/v2-core/contracts/interfaces/IUniswapV2Pair.sol';
```

```
pragma solidity >=0.5.0;

interface IUniswapV2Pair {
  event Approval(address indexed owner, address indexed spender, uint value);
  event Transfer(address indexed from, address indexed to, uint value);

  function name() external pure returns (string memory);
  function symbol() external pure returns (string memory);
  function decimals() external pure returns (uint8);
  function totalSupply() external view returns (uint);
  function balanceOf(address owner) external view returns (uint);
  function allowance(address owner, address spender) external view returns (uint);

  function approve(address spender, uint value) external returns (bool);
  function transfer(address to, uint value) external returns (bool);
  function transferFrom(address from, address to, uint value) external returns (bool);

  function DOMAIN_SEPARATOR() external view returns (bytes32);
  function PERMIT_TYPEHASH() external pure returns (bytes32);
  function nonces(address owner) external view returns (uint);

  function permit(address owner, address spender, uint value, uint deadline, uint8 v, bytes32 r, bytes32 s) external;

  event Mint(address indexed sender, uint amount0, uint amount1);
  event Burn(address indexed sender, uint amount0, uint amount1, address indexed to);
  event Swap(
      address indexed sender,
      uint amount0In,
      uint amount1In,
      uint amount0Out,
      uint amount1Out,
      address indexed to
  );
  event Sync(uint112 reserve0, uint112 reserve1);

  function MINIMUM_LIQUIDITY() external pure returns (uint);
  function factory() external view returns (address);
  function token0() external view returns (address);
  function token1() external view returns (address);
  function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast);
  function price0CumulativeLast() external view returns (uint);
  function price1CumulativeLast() external view returns (uint);
  function kLast() external view returns (uint);

  function mint(address to) external returns (uint liquidity);
  function burn(address to) external returns (uint amount0, uint amount1);
  function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external;
  function skim(address to) external;
  function sync() external;
}
```

### 四、Pair(ERC-20)

本文档涵盖了用于命名池代币的 ERC-20 功能。 对于 Uniswap 特定的功能，see [Pair](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair)。

**代码地址**：[`UniswapV2ERC20.sol`](https://github.com/Uniswap/uniswap-v2-core/blob/master/contracts/UniswapV2ERC20.sol)

##### 4.1 Events

###### 4.1.1 Approval

```
event Approval(address indexed owner, address indexed spender, uint value);
```

Emitted each time an approval occurs via [approve](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#approve) or [permit](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#permit).

###### 4.1.2 Transfer

```
event Transfer(address indexed from, address indexed to, uint value);
```

Emitted each time a transfer occurs via [transfer](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#transfer-1), [transferFrom](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#transferfrom), [mint](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#mint-1), or [burn](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#burn-1).

##### 4.2 Read-Only Functions

###### 4.2.1 name

```
function name() external pure returns (string memory);
```

Returns `Uniswap V2` for all pairs.

###### 4.2.2 symbol

```
function symbol() external pure returns (string memory);
```

Returns `UNI-V2` for all pairs.

###### 4.2.3 decimals

```
function decimals() external pure returns (uint8);
```

Returns `18` for all pairs.

###### 4.2.4 totalSupply

```
function totalSupply() external view returns (uint);
```

Returns the total amount of pool tokens for a pair.

###### 4.2.5 balanceOf

```
function balanceOf(address owner) external view returns (uint);
```

Returns the amount of pool tokens owned by an address.

###### 4.2.6 allowance

```
function allowance(address owner, address spender) external view returns (uint);
```

Returns the amount of liquidity tokens owned by an address that a spender is allowed to transfer via [transferFrom](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#transferfrom).

###### 4.2.7 DOMAIN_SEPARATOR

```
function DOMAIN_SEPARATOR() external view returns (bytes32);
```

Returns a domain separator for use in [permit](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#permit).

###### 4.2.8 PERMIT_TYPEHASH

```
function PERMIT_TYPEHASH() external view returns (bytes32);
```

Returns a typehash for use in [permit](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#permit).

###### 4.2.9 nonces

```
function nonces(address owner) external view returns (uint);
```

Returns the current nonce for an address for use in [permit](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#permit).

##### 4.3  State-Changing Functions

###### 4.3.1 approve

```
function approve(address spender, uint value) external returns (bool);
```

Lets `msg.sender` set their allowance for a spender.

- Emits [Approval](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/Pair-ERC-20#approval).

###### 4.3.2 transfer

```
function transfer(address to, uint value) external returns (bool);
```

Lets `msg.sender` send pool tokens to an address.

- Emits [Transfer](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/Pair-ERC-20#transfer).

###### 4.3.3 transferFrom

```
function transferFrom(address from, address to, uint value) external returns (bool);
```

Sends pool tokens from one address to another.

- Requires approval.
- Emits [Transfer](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/Pair-ERC-20#transfer).

###### 4.3.4 permit

```
function permit(address owner, address spender, uint value, uint deadline, uint8 v, bytes32 r, bytes32 s) external;
```

Sets the allowance for a spender where approval is granted via a signature.

- See [Using Permit](https://docs.uniswap.org/protocol/V2/guides/smart-contract-integration/supporting-meta-transactions).
- Emits [Approval](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/Pair-ERC-20#approval).

##### 4.4 Interface

```
import '@uniswap/v2-core/contracts/interfaces/IUniswapV2ERC20.sol';
```

Copy

```
pragma solidity >=0.5.0;

interface IUniswapV2ERC20 {
  event Approval(address indexed owner, address indexed spender, uint value);
  event Transfer(address indexed from, address indexed to, uint value);

  function name() external pure returns (string memory);
  function symbol() external pure returns (string memory);
  function decimals() external pure returns (uint8);
  function totalSupply() external view returns (uint);
  function balanceOf(address owner) external view returns (uint);
  function allowance(address owner, address spender) external view returns (uint);

  function approve(address spender, uint value) external returns (bool);
  function transfer(address to, uint value) external returns (bool);
  function transferFrom(address from, address to, uint value) external returns (bool);

  function DOMAIN_SEPARATOR() external view returns (bytes32);
  function PERMIT_TYPEHASH() external pure returns (bytes32);
  function nonces(address owner) external view returns (uint);

  function permit(address owner, address spender, uint value, uint deadline, uint8 v, bytes32 r, bytes32 s) external;
}
```

### 五、Router02

由于router是无状态的并且不持有代币余额，因此可以在必要时安全且无需信任地更换它们。 如果发现了更有效的智能合约模式，或者需要额外的功能，这可能会发生。 出于这个原因，路由器的版本号从 01 开始。目前推荐的版本号是 02。

**代码地址**：[`UniswapV2Router02.sol`](https://github.com/Uniswap/uniswap-v2-periphery/blob/master/contracts/UniswapV2Router02.sol)

**合约地址**：`UniswapV2Router02` is deployed at `0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D` on the Ethereum [mainnet](https://etherscan.io/address/0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D), and the [Ropsten](https://ropsten.etherscan.io/address/0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D), [Rinkeby](https://rinkeby.etherscan.io/address/0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D), [Görli](https://goerli.etherscan.io/address/0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D), and [Kovan](https://kovan.etherscan.io/address/0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D) testnets. It was built from commit [6961711](https://github.com/Uniswap/uniswap-v2-periphery/tree/69617118cda519dab608898d62aaa79877a61004).

##### 5.1 Read-Only Functions

###### 5.1.1 factory

```
function factory() external pure returns (address);
```

Returns [factory address](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory#address).

###### 5.1.2 WETH

```
function WETH() external pure returns (address);
```

Returns the [canonical WETH address](https://blog.0xproject.com/canonical-weth-a9aa7d0279dd) on the Ethereum [mainnet](https://etherscan.io/address/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2), or the [Ropsten](https://ropsten.etherscan.io/address/0xc778417e063141139fce010982780140aa0cd5ab), [Rinkeby](https://rinkeby.etherscan.io/address/0xc778417e063141139fce010982780140aa0cd5ab), [Görli](https://goerli.etherscan.io/address/0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6), or [Kovan](https://kovan.etherscan.io/address/0xd0a1e359811322d97991e03f863a0c30c2cf029c) testnets.

###### 5.1.3 quote

See [quote](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/library#quote).

###### 5.1.4 getAmountOut

See [getAmountOut](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/library#getamountout).

###### 5.1.5 getAmountIn

See [getAmountIn](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/library#getamountin).

###### 5.1.6 getAmountsOut

```
function getAmountsOut(uint amountIn, address[] memory path) public view returns (uint[] memory amounts);
```

See [getAmountsOut](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/library#getamountsout).

###### 5.1.7 getAmountsIn

```
function getAmountsIn(uint amountOut, address[] memory path) public view returns (uint[] memory amounts);
```

##### 5.2 State-Changing Functions

###### 5.2.1 addLiquidity

```
function addLiquidity(  address tokenA,  address tokenB,  uint amountADesired,  uint amountBDesired,  uint amountAMin,  uint amountBMin,  address to,  uint deadline) external returns (uint amountA, uint amountB, uint liquidity);
```

Adds liquidity to an ERC-20⇄ERC-20 pool.

- To cover all possible scenarios, `msg.sender` should have already given the router an allowance of at least amountADesired/amountBDesired on tokenA/tokenB.
- Always adds assets at the ideal ratio, according to the price when the transaction is executed.
- If a pool for the passed tokens does not exists, one is created automatically, and exactly amountADesired/amountBDesired tokens are added.

| Name           | Type      |                                                                                                                |
| -------------- | --------- | -------------------------------------------------------------------------------------------------------------- |
| tokenA         | `address` | A pool token.                                                                                                  |
| tokenB         | `address` | A pool token.                                                                                                  |
| amountADesired | `uint`    | The amount of tokenA to add as liquidity if the B/A price is <= amountBDesired/amountADesired (A depreciates). |
| amountBDesired | `uint`    | The amount of tokenB to add as liquidity if the A/B price is <= amountADesired/amountBDesired (B depreciates). |
| amountAMin     | `uint`    | Bounds the extent to which the B/A price can go up before the transaction reverts. Must be <= amountADesired.  |
| amountBMin     | `uint`    | Bounds the extent to which the A/B price can go up before the transaction reverts. Must be <= amountBDesired.  |
| to             | `address` | Recipient of the liquidity tokens.                                                                             |
| deadline       | `uint`    | Unix timestamp after which the transaction will revert.                                                        |
|                |           |                                                                                                                |
| amountA        | `uint`    | The amount of tokenA sent to the pool.                                                                         |
| amountB        | `uint`    | The amount of tokenB sent to the pool.                                                                         |
| liquidity      | `uint`    | The amount of liquidity tokens minted.                                                                         |

###### 5.2.2 addLiquidityETH

```
function addLiquidityETH(  address token,  uint amountTokenDesired,  uint amountTokenMin,  uint amountETHMin,  address to,  uint deadline) external payable returns (uint amountToken, uint amountETH, uint liquidity);
```

Adds liquidity to an ERC-20⇄WETH pool with ETH.

- To cover all possible scenarios, `msg.sender` should have already given the router an allowance of at least amountTokenDesired on token.
- Always adds assets at the ideal ratio, according to the price when the transaction is executed.
- `msg.value` is treated as a amountETHDesired.
- Leftover ETH, if any, is returned to `msg.sender`.
- If a pool for the passed token and WETH does not exists, one is created automatically, and exactly amountTokenDesired/`msg.value` tokens are added.

| Name                           | Type      |                                                                                                                           |
| ------------------------------ | --------- | ------------------------------------------------------------------------------------------------------------------------- |
| token                          | `address` | A pool token.                                                                                                             |
| amountTokenDesired             | `uint`    | The amount of token to add as liquidity if the WETH/token price is <= `msg.value`/amountTokenDesired (token depreciates). |
| `msg.value` (amountETHDesired) | `uint`    | The amount of ETH to add as liquidity if the token/WETH price is <= amountTokenDesired/`msg.value` (WETH depreciates).    |
| amountTokenMin                 | `uint`    | Bounds the extent to which the WETH/token price can go up before the transaction reverts. Must be <= amountTokenDesired.  |
| amountETHMin                   | `uint`    | Bounds the extent to which the token/WETH price can go up before the transaction reverts. Must be <= `msg.value`.         |
| to                             | `address` | Recipient of the liquidity tokens.                                                                                        |
| deadline                       | `uint`    | Unix timestamp after which the transaction will revert.                                                                   |
|                                |           |                                                                                                                           |
| amountToken                    | `uint`    | The amount of token sent to the pool.                                                                                     |
| amountETH                      | `uint`    | The amount of ETH converted to WETH and sent to the pool.                                                                 |
| liquidity                      | `uint`    | The amount of liquidity tokens minted.                                                                                    |

###### 5.2.3 removeLiquidity

```
function removeLiquidity(  address tokenA,  address tokenB,  uint liquidity,  uint amountAMin,  uint amountBMin,  address to,  uint deadline) external returns (uint amountA, uint amountB);
```

Removes liquidity from an ERC-20⇄ERC-20 pool.

- `msg.sender` should have already given the router an allowance of at least liquidity on the pool.

| Name       | Type      |                                                                                       |
| ---------- | --------- | ------------------------------------------------------------------------------------- |
| tokenA     | `address` | A pool token.                                                                         |
| tokenB     | `address` | A pool token.                                                                         |
| liquidity  | `uint`    | The amount of liquidity tokens to remove.                                             |
| amountAMin | `uint`    | The minimum amount of tokenA that must be received for the transaction not to revert. |
| amountBMin | `uint`    | The minimum amount of tokenB that must be received for the transaction not to revert. |
| to         | `address` | Recipient of the underlying assets.                                                   |
| deadline   | `uint`    | Unix timestamp after which the transaction will revert.                               |
|            |           |                                                                                       |
| amountA    | `uint`    | The amount of tokenA received.                                                        |
| amountB    | `uint`    | The amount of tokenB received.                                                        |

###### 5.2.4 removeLiquidityETH

```
function removeLiquidityETH(  address token,  uint liquidity,  uint amountTokenMin,  uint amountETHMin,  address to,  uint deadline) external returns (uint amountToken, uint amountETH);
```

Removes liquidity from an ERC-20⇄WETH pool and receive ETH.

- `msg.sender` should have already given the router an allowance of at least liquidity on the pool.

| Name           | Type      |                                                                                      |
| -------------- | --------- | ------------------------------------------------------------------------------------ |
| token          | `address` | A pool token.                                                                        |
| liquidity      | `uint`    | The amount of liquidity tokens to remove.                                            |
| amountTokenMin | `uint`    | The minimum amount of token that must be received for the transaction not to revert. |
| amountETHMin   | `uint`    | The minimum amount of ETH that must be received for the transaction not to revert.   |
| to             | `address` | Recipient of the underlying assets.                                                  |
| deadline       | `uint`    | Unix timestamp after which the transaction will revert.                              |
|                |           |                                                                                      |
| amountToken    | `uint`    | The amount of token received.                                                        |
| amountETH      | `uint`    | The amount of ETH received.                                                          |

###### 5.2.5 removeLiquidityWithPermit

```
function removeLiquidityWithPermit(  address tokenA,  address tokenB,  uint liquidity,  uint amountAMin,  uint amountBMin,  address to,  uint deadline,  bool approveMax, uint8 v, bytes32 r, bytes32 s) external returns (uint amountA, uint amountB);
```

Removes liquidity from an ERC-20⇄ERC-20 pool without pre-approval, thanks to [permit](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#permit).

| Name       | Type      |                                                                                       |
| ---------- | --------- | ------------------------------------------------------------------------------------- |
| tokenA     | `address` | A pool token.                                                                         |
| tokenB     | `address` | A pool token.                                                                         |
| liquidity  | `uint`    | The amount of liquidity tokens to remove.                                             |
| amountAMin | `uint`    | The minimum amount of tokenA that must be received for the transaction not to revert. |
| amountBMin | `uint`    | The minimum amount of tokenB that must be received for the transaction not to revert. |
| to         | `address` | Recipient of the underlying assets.                                                   |
| deadline   | `uint`    | Unix timestamp after which the transaction will revert.                               |
| approveMax | `bool`    | Whether or not the approval amount in the signature is for liquidity or `uint(-1)`.   |
| v          | `uint8`   | The v component of the permit signature.                                              |
| r          | `bytes32` | The r component of the permit signature.                                              |
| s          | `bytes32` | The s component of the permit signature.                                              |
|            |           |                                                                                       |
| amountA    | `uint`    | The amount of tokenA received.                                                        |
| amountB    | `uint`    | The amount of tokenB received.                                                        |

###### 5.2.6 removeLiquidityETHWithPermit

```
function removeLiquidityETHWithPermit(  address token,  uint liquidity,  uint amountTokenMin,  uint amountETHMin,  address to,  uint deadline,  bool approveMax, uint8 v, bytes32 r, bytes32 s) external returns (uint amountToken, uint amountETH);
```

Removes liquidity from an ERC-20⇄WETTH pool and receive ETH without pre-approval, thanks to [permit](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair-erc-20#permit).

| Name           | Type      |                                                                                      |
| -------------- | --------- | ------------------------------------------------------------------------------------ |
| token          | `address` | A pool token.                                                                        |
| liquidity      | `uint`    | The amount of liquidity tokens to remove.                                            |
| amountTokenMin | `uint`    | The minimum amount of token that must be received for the transaction not to revert. |
| amountETHMin   | `uint`    | The minimum amount of ETH that must be received for the transaction not to revert.   |
| to             | `address` | Recipient of the underlying assets.                                                  |
| deadline       | `uint`    | Unix timestamp after which the transaction will revert.                              |
| approveMax     | `bool`    | Whether or not the approval amount in the signature is for liquidity or `uint(-1)`.  |
| v              | `uint8`   | The v component of the permit signature.                                             |
| r              | `bytes32` | The r component of the permit signature.                                             |
| s              | `bytes32` | The s component of the permit signature.                                             |
|                |           |                                                                                      |
| amountToken    | `uint`    | The amount of token received.                                                        |
| amountETH      | `uint`    | The amount of ETH received.                                                          |

###### 5.2.7 removeLiquidityETHSupportingFeeOnTransferTokens

```
function removeLiquidityETHSupportingFeeOnTransferTokens(  address token,  uint liquidity,  uint amountTokenMin,  uint amountETHMin,  address to,  uint deadline) external returns (uint amountETH);
```

Identical to [removeLiquidityETH](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/router-02#removeliquidityeth), but succeeds for tokens that take a fee on transfer.

- `msg.sender` should have already given the router an allowance of at least liquidity on the pool.

| Name           | Type      |                                                                                      |
| -------------- | --------- | ------------------------------------------------------------------------------------ |
| token          | `address` | A pool token.                                                                        |
| liquidity      | `uint`    | The amount of liquidity tokens to remove.                                            |
| amountTokenMin | `uint`    | The minimum amount of token that must be received for the transaction not to revert. |
| amountETHMin   | `uint`    | The minimum amount of ETH that must be received for the transaction not to revert.   |
| to             | `address` | Recipient of the underlying assets.                                                  |
| deadline       | `uint`    | Unix timestamp after which the transaction will revert.                              |
|                |           |                                                                                      |
| amountETH      | `uint`    | The amount of ETH received.                                                          |

###### 5.2.8 removeLiquidityETHWithPermitSupportingFeeOnTransferTokens

```
function removeLiquidityETHWithPermitSupportingFeeOnTransferTokens(  address token,  uint liquidity,  uint amountTokenMin,  uint amountETHMin,  address to,  uint deadline,  bool approveMax, uint8 v, bytes32 r, bytes32 s) external returns (uint amountETH);
```

Identical to [removeLiquidityETHWithPermit](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/router-02#removeliquidityethwithpermit), but succeeds for tokens that take a fee on transfer.

| Name           | Type      |                                                                                      |
| -------------- | --------- | ------------------------------------------------------------------------------------ |
| token          | `address` | A pool token.                                                                        |
| liquidity      | `uint`    | The amount of liquidity tokens to remove.                                            |
| amountTokenMin | `uint`    | The minimum amount of token that must be received for the transaction not to revert. |
| amountETHMin   | `uint`    | The minimum amount of ETH that must be received for the transaction not to revert.   |
| to             | `address` | Recipient of the underlying assets.                                                  |
| deadline       | `uint`    | Unix timestamp after which the transaction will revert.                              |
| approveMax     | `bool`    | Whether or not the approval amount in the signature is for liquidity or `uint(-1)`.  |
| v              | `uint8`   | The v component of the permit signature.                                             |
| r              | `bytes32` | The r component of the permit signature.                                             |
| s              | `bytes32` | The s component of the permit signature.                                             |
|                |           |                                                                                      |
| amountETH      | `uint`    | The amount of ETH received.                                                          |

###### 5.2.9 swapExactTokensForTokens

```
function swapExactTokensForTokens(  uint amountIn,  uint amountOutMin,  address[] calldata path,  address to,  uint deadline) external returns (uint[] memory amounts);
```

Swaps an exact amount of input tokens for as many output tokens as possible, along the route determined by the path. The first element of path is the input token, the last is the output token, and any intermediate elements represent intermediate pairs to trade through (if, for example, a direct pair does not exist).

- `msg.sender` should have already given the router an allowance of at least amountIn on the input token.

| Name         | Type                 |                                                                                                                                      |
| ------------ | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| amountIn     | `uint`               | The amount of input tokens to send.                                                                                                  |
| amountOutMin | `uint`               | The minimum amount of output tokens that must be received for the transaction not to revert.                                         |
| path         | `address[] calldata` | An array of token addresses. `path.length` must be >= 2. Pools for each consecutive pair of addresses must exist and have liquidity. |
| to           | `address`            | Recipient of the output tokens.                                                                                                      |
| deadline     | `uint`               | Unix timestamp after which the transaction will revert.                                                                              |
|              |                      |                                                                                                                                      |
| amounts      | `uint[] memory`      | The input token amount and all subsequent output token amounts.                                                                      |

###### 5.2.10 swapTokensForExactTokens

```
function swapTokensForExactTokens(  uint amountOut,  uint amountInMax,  address[] calldata path,  address to,  uint deadline) external returns (uint[] memory amounts);
```

Receive an exact amount of output tokens for as few input tokens as possible, along the route determined by the path. The first element of path is the input token, the last is the output token, and any intermediate elements represent intermediate tokens to trade through (if, for example, a direct pair does not exist).

- `msg.sender` should have already given the router an allowance of at least amountInMax on the input token.

| Name        | Type                 |                                                                                                                                      |
| ----------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| amountOut   | `uint`               | The amount of output tokens to receive.                                                                                              |
| amountInMax | `uint`               | The maximum amount of input tokens that can be required before the transaction reverts.                                              |
| path        | `address[] calldata` | An array of token addresses. `path.length` must be >= 2. Pools for each consecutive pair of addresses must exist and have liquidity. |
| to          | `address`            | Recipient of the output tokens.                                                                                                      |
| deadline    | `uint`               | Unix timestamp after which the transaction will revert.                                                                              |
|             |                      |                                                                                                                                      |
| amounts     | `uint[] memory`      | The input token amount and all subsequent output token amounts.                                                                      |

###### 5.2.11 swapExactETHForTokens

```
function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline)  external  payable  returns (uint[] memory amounts);
```

Swaps an exact amount of ETH for as many output tokens as possible, along the route determined by the path. The first element of path must be [WETH](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/router-02#weth), the last is the output token, and any intermediate elements represent intermediate pairs to trade through (if, for example, a direct pair does not exist).

| Name                   | Type                 |                                                                                                                                      |
| ---------------------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `msg.value` (amountIn) | `uint`               | The amount of ETH to send.                                                                                                           |
| amountOutMin           | `uint`               | The minimum amount of output tokens that must be received for the transaction not to revert.                                         |
| path                   | `address[] calldata` | An array of token addresses. `path.length` must be >= 2. Pools for each consecutive pair of addresses must exist and have liquidity. |
| to                     | `address`            | Recipient of the output tokens.                                                                                                      |
| deadline               | `uint`               | Unix timestamp after which the transaction will revert.                                                                              |
|                        |                      |                                                                                                                                      |
| amounts                | `uint[] memory`      | The input token amount and all subsequent output token amounts.                                                                      |

###### 5.2.12 swapTokensForExactETH

```
function swapTokensForExactETH(uint amountOut, uint amountInMax, address[] calldata path, address to, uint deadline)  external  returns (uint[] memory amounts);
```

Receive an exact amount of ETH for as few input tokens as possible, along the route determined by the path. The first element of path is the input token, the last must be [WETH](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/router-02#weth), and any intermediate elements represent intermediate pairs to trade through (if, for example, a direct pair does not exist).

- `msg.sender` should have already given the router an allowance of at least amountInMax on the input token.
- If the to address is a smart contract, it must have the ability to receive ETH.

| Name        | Type                 |                                                                                                                                      |
| ----------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| amountOut   | `uint`               | The amount of ETH to receive.                                                                                                        |
| amountInMax | `uint`               | The maximum amount of input tokens that can be required before the transaction reverts.                                              |
| path        | `address[] calldata` | An array of token addresses. `path.length` must be >= 2. Pools for each consecutive pair of addresses must exist and have liquidity. |
| to          | `address`            | Recipient of ETH.                                                                                                                    |
| deadline    | `uint`               | Unix timestamp after which the transaction will revert.                                                                              |
|             |                      |                                                                                                                                      |
| amounts     | `uint[] memory`      | The input token amount and all subsequent output token amounts.                                                                      |

###### 5.2.13 swapExactTokensForETH

```
function swapExactTokensForETH(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)  external  returns (uint[] memory amounts);
```

Swaps an exact amount of tokens for as much ETH as possible, along the route determined by the path. The first element of path is the input token, the last must be [WETH](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/router-02#weth), and any intermediate elements represent intermediate pairs to trade through (if, for example, a direct pair does not exist).

- If the to address is a smart contract, it must have the ability to receive ETH.

| Name         | Type                 |                                                                                                                                      |
| ------------ | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| amountIn     | `uint`               | The amount of input tokens to send.                                                                                                  |
| amountOutMin | `uint`               | The minimum amount of output tokens that must be received for the transaction not to revert.                                         |
| path         | `address[] calldata` | An array of token addresses. `path.length` must be >= 2. Pools for each consecutive pair of addresses must exist and have liquidity. |
| to           | `address`            | Recipient of the ETH.                                                                                                                |
| deadline     | `uint`               | Unix timestamp after which the transaction will revert.                                                                              |
|              |                      |                                                                                                                                      |
| amounts      | `uint[] memory`      | The input token amount and all subsequent output token amounts.                                                                      |

###### 5.2.14 swapETHForExactTokens

```
function swapETHForExactTokens(uint amountOut, address[] calldata path, address to, uint deadline)  external  payable  returns (uint[] memory amounts);
```

Receive an exact amount of tokens for as little ETH as possible, along the route determined by the path. The first element of path must be [WETH](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/router-02#weth), the last is the output token and any intermediate elements represent intermediate pairs to trade through (if, for example, a direct pair does not exist).

- Leftover ETH, if any, is returned to `msg.sender`.

| Name                      | Type                 |                                                                                                                                      |
| ------------------------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| amountOut                 | `uint`               | The amount of tokens to receive.                                                                                                     |
| `msg.value` (amountInMax) | `uint`               | The maximum amount of ETH that can be required before the transaction reverts.                                                       |
| path                      | `address[] calldata` | An array of token addresses. `path.length` must be >= 2. Pools for each consecutive pair of addresses must exist and have liquidity. |
| to                        | `address`            | Recipient of the output tokens.                                                                                                      |
| deadline                  | `uint`               | Unix timestamp after which the transaction will revert.                                                                              |
|                           |                      |                                                                                                                                      |
| amounts                   | `uint[] memory`      | The input token amount and all subsequent output token amounts.                                                                      |

###### 5.2.15 swapExactTokensForTokensSupportingFeeOnTransferTokens

```
function swapExactTokensForTokensSupportingFeeOnTransferTokens(  uint amountIn,  uint amountOutMin,  address[] calldata path,  address to,  uint deadline) external;
```

Identical to [swapExactTokensForTokens](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/router-02#swapexacttokensfortokens), but succeeds for tokens that take a fee on transfer.

- `msg.sender` should have already given the router an allowance of at least amountIn on the input token.

| Name         | Type                 |                                                                                                                                      |
| ------------ | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| amountIn     | `uint`               | The amount of input tokens to send.                                                                                                  |
| amountOutMin | `uint`               | The minimum amount of output tokens that must be received for the transaction not to revert.                                         |
| path         | `address[] calldata` | An array of token addresses. `path.length` must be >= 2. Pools for each consecutive pair of addresses must exist and have liquidity. |
| to           | `address`            | Recipient of the output tokens.                                                                                                      |
| deadline     | `uint`               | Unix timestamp after which the transaction will revert.                                                                              |

###### 5.2.16 swapExactETHForTokensSupportingFeeOnTransferTokens

```
function swapExactETHForTokensSupportingFeeOnTransferTokens(  uint amountOutMin,  address[] calldata path,  address to,  uint deadline) external payable;
```

Identical to [swapExactETHForTokens](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/router-02#swapexactethfortokens), but succeeds for tokens that take a fee on transfer.

| Name                   | Type                 |                                                                                                                                      |
| ---------------------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `msg.value` (amountIn) | `uint`               | The amount of ETH to send.                                                                                                           |
| amountOutMin           | `uint`               | The minimum amount of output tokens that must be received for the transaction not to revert.                                         |
| path                   | `address[] calldata` | An array of token addresses. `path.length` must be >= 2. Pools for each consecutive pair of addresses must exist and have liquidity. |
| to                     | `address`            | Recipient of the output tokens.                                                                                                      |
| deadline               | `uint`               | Unix timestamp after which the transaction will revert.                                                                              |

###### 5.2.17 swapExactTokensForETHSupportingFeeOnTransferTokens

```
function swapExactTokensForETHSupportingFeeOnTransferTokens(  uint amountIn,  uint amountOutMin,  address[] calldata path,  address to,  uint deadline) external;
```

Identical to [swapExactTokensForETH](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/router-02#swapexacttokensforeth), but succeeds for tokens that take a fee on transfer.

- If the to address is a smart contract, it must have the ability to receive ETH.

| Name         | Type                 |                                                                                                                                      |
| ------------ | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| amountIn     | `uint`               | The amount of input tokens to send.                                                                                                  |
| amountOutMin | `uint`               | The minimum amount of output tokens that must be received for the transaction not to revert.                                         |
| path         | `address[] calldata` | An array of token addresses. `path.length` must be >= 2. Pools for each consecutive pair of addresses must exist and have liquidity. |
| to           | `address`            | Recipient of the ETH.                                                                                                                |
| deadline     | `uint`               | Unix timestamp after which the transaction will revert.                                                                              |

###### 5.3 interface

```
import '@uniswap/v2-periphery/contracts/interfaces/IUniswapV2Router02.sol';
```

```
pragma solidity >=0.6.2;

interface IUniswapV2Router01 {
    function factory() external pure returns (address);
    function WETH() external pure returns (address);

    function addLiquidity(
        address tokenA,
        address tokenB,
        uint amountADesired,
        uint amountBDesired,
        uint amountAMin,
        uint amountBMin,
        address to,
        uint deadline
    ) external returns (uint amountA, uint amountB, uint liquidity);
    function addLiquidityETH(
        address token,
        uint amountTokenDesired,
        uint amountTokenMin,
        uint amountETHMin,
        address to,
        uint deadline
    ) external payable returns (uint amountToken, uint amountETH, uint liquidity);
    function removeLiquidity(
        address tokenA,
        address tokenB,
        uint liquidity,
        uint amountAMin,
        uint amountBMin,
        address to,
        uint deadline
    ) external returns (uint amountA, uint amountB);
    function removeLiquidityETH(
        address token,
        uint liquidity,
        uint amountTokenMin,
        uint amountETHMin,
        address to,
        uint deadline
    ) external returns (uint amountToken, uint amountETH);
    function removeLiquidityWithPermit(
        address tokenA,
        address tokenB,
        uint liquidity,
        uint amountAMin,
        uint amountBMin,
        address to,
        uint deadline,
        bool approveMax, uint8 v, bytes32 r, bytes32 s
    ) external returns (uint amountA, uint amountB);
    function removeLiquidityETHWithPermit(
        address token,
        uint liquidity,
        uint amountTokenMin,
        uint amountETHMin,
        address to,
        uint deadline,
        bool approveMax, uint8 v, bytes32 r, bytes32 s
    ) external returns (uint amountToken, uint amountETH);
    function swapExactTokensForTokens(
        uint amountIn,
        uint amountOutMin,
        address[] calldata path,
        address to,
        uint deadline
    ) external returns (uint[] memory amounts);
    function swapTokensForExactTokens(
        uint amountOut,
        uint amountInMax,
        address[] calldata path,
        address to,
        uint deadline
    ) external returns (uint[] memory amounts);
    function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline)
        external
        payable
        returns (uint[] memory amounts);
    function swapTokensForExactETH(uint amountOut, uint amountInMax, address[] calldata path, address to, uint deadline)
        external
        returns (uint[] memory amounts);
    function swapExactTokensForETH(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)
        external
        returns (uint[] memory amounts);
    function swapETHForExactTokens(uint amountOut, address[] calldata path, address to, uint deadline)
        external
        payable
        returns (uint[] memory amounts);

    function quote(uint amountA, uint reserveA, uint reserveB) external pure returns (uint amountB);
    function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut) external pure returns (uint amountOut);
    function getAmountIn(uint amountOut, uint reserveIn, uint reserveOut) external pure returns (uint amountIn);
    function getAmountsOut(uint amountIn, address[] calldata path) external view returns (uint[] memory amounts);
    function getAmountsIn(uint amountOut, address[] calldata path) external view returns (uint[] memory amounts);
}

interface IUniswapV2Router02 is IUniswapV2Router01 {
    function removeLiquidityETHSupportingFeeOnTransferTokens(
        address token,
        uint liquidity,
        uint amountTokenMin,
        uint amountETHMin,
        address to,
        uint deadline
    ) external returns (uint amountETH);
    function removeLiquidityETHWithPermitSupportingFeeOnTransferTokens(
        address token,
        uint liquidity,
        uint amountTokenMin,
        uint amountETHMin,
        address to,
        uint deadline,
        bool approveMax, uint8 v, bytes32 r, bytes32 s
    ) external returns (uint amountETH);

    function swapExactTokensForTokensSupportingFeeOnTransferTokens(
        uint amountIn,
        uint amountOutMin,
        address[] calldata path,
        address to,
        uint deadline
    ) external;
    function swapExactETHForTokensSupportingFeeOnTransferTokens(
        uint amountOutMin,
        address[] calldata path,
        address to,
        uint deadline
    ) external payable;
    function swapExactTokensForETHSupportingFeeOnTransferTokens(
        uint amountIn,
        uint amountOutMin,
        address[] calldata path,
        address to,
        uint deadline
    ) external;
}
```

### 六、Library

**代码地址：** https://github.com/Uniswap/uniswap-v2-periphery/blob/master/contracts/libraries/UniswapV2Library.sol

##### 6.1  Internal Functions

###### 6.1.1 sortTokens

```
function sortTokens(address tokenA, address tokenB) internal pure returns (address token0, address token1);
```

Sorts token addresses.

###### 6.1.2 pairFor

```
function pairFor(address factory, address tokenA, address tokenB) internal pure returns (address pair);
```

Calculates the address for a pair without making any external calls via the v2 SDK.

###### 6.1.3 getReserves

```
function getReserves(address factory, address tokenA, address tokenB) internal view returns (uint reserveA, uint reserveB);
```

Calls [getReserves](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#getreserves) on the pair for the passed tokens, and returns the results sorted in the order that the parameters were passed in.

###### 6.1.4 quote

```
function quote(uint amountA, uint reserveA, uint reserveB) internal pure returns (uint amountB);
```

Given some asset amount and reserves, returns an amount of the other asset representing equivalent value.

- Useful for calculating optimal token amounts before calling [mint](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#mint-1).

###### 6.1.5 getAmountOut

```
function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut) internal pure returns (uint amountOut);
```

Given an *input* asset amount, returns the maximum *output* amount of the other asset (accounting for fees) given reserves.

- Used in [getAmountsOut](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/library#getamountsout).

###### 6.1.6 getAmountIn

```
function getAmountIn(uint amountOut, uint reserveIn, uint reserveOut) internal pure returns (uint amountIn);
```

Returns the minimum *input* asset amount required to buy the given *output* asset amount (accounting for fees) given reserves.

- Used in [getAmountsIn](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/library#getamountsin).

###### 6.1.7 getAmountsOut

```
function getAmountsOut(uint amountIn, address[] memory path) internal view returns (uint[] memory amounts);
```

Given an *input* asset amount and an array of token addresses, calculates all subsequent maximum *output* token amounts by calling [getReserves](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/library#getreserves) for each pair of token addresses in the path in turn, and using these to call [getAmountOut](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/library#getamountout).

- Useful for calculating optimal token amounts before calling [swap](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#swap-1).

###### 6.1.8 getAmountsIn

```
function getAmountsIn(uint amountOut, address[] memory path) internal view returns (uint[] memory amounts);
```

Given an *output* asset amount and an array of token addresses, calculates all preceding minimum *input* token amounts by calling [getReserves](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/library#getreserves) for each pair of token addresses in the path in turn, and using these to call [getAmountIn](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/library#getamountin).

- Useful for calculating optimal token amounts before calling [swap](https://docs.uniswap.org/protocol/V2/reference/smart-contracts/pair#swap-1).

### 七：总结

代码阅读不光要读合约内容，还要把test和example下面的读懂，结合一些业务场景来理解会更有效果。
